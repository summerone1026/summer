<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../css/mui.css" rel="stylesheet" />
		<link href="../css/video-js.css" rel="stylesheet">
<!-- 		 <link href="../css/video-js.min.css" rel="stylesheet"> -->
		 <script src="../js/video.js"></script>
<!-- 		<script src="../js/video.min.js"></script> -->
		<script src="../js/videojs-contrib-hls.min.js"></script>
		<script src="../js/mui.min.js"></script>
		<script src="../js/lib/common.js"></script>

	</head>
		
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" id="muiBackButton"></a>
		<h5 class="mui-title" id="videoName"></h5>
	</header>
	<body>
		<div class="mui-content" id="videoNode">
			<!-- <video id="video" class="video-js vjs-big-play-centered vjs-fluid" controls="" autoplay="true" topreload="auto" height="300" width="100%" loop="true" poster="" data-setup="{}"> <source src="https://d2zihajmogu5jn.cloudfront.net/bipbop-advanced/bipbop_16x9_variant.m3u8" type="application/x-mpegURL"> <p class="vjs-no-js">TEST</p> </video> -->
		</div>

	</body>
	
	<script type="text/javascript">
		mui.init();
		mui.plusReady(function(){
			var self = plus.webview.currentWebview();
			var videoId = self.videoId;
			var name = self.name;//获得参数
			var pic = self.pic;
			var src = self.src;

			//添加观影记录
			addVideoInformation(videoId, name, pic, src);
			
			//获取最新播放总数,并更新播放次数
			mui.getJSON(APP_DOMAIN + "/videos/" + videoId, function(data){
				var hits = data["vod_hits"];
				updateVideoHits(++hits);
				}
			);

			document.getElementById("videoName").innerHTML = name;
			document.getElementById("videoNode").innerHTML = '<video \
				id="video" \
				class="video-js vjs-big-play-centered vjs-fluid" \
				controls="" \
				autoplay="ture" \
				topreload="auto" \
				height="300" \
				width="100%" \
				loop="true" \
				poster="" \
				data-setup="{}"> \
				<source src="' + src + '" type="application/x-mpegURL"> \
				<p class="vjs-no-js">TEST</p> \
				</video>';
			var options = {};
			var player = videojs('video', options, function onPlayerReady() {
			  videojs.log('Your player is ready!');

			  // In this context, `this` is the player that was created by Video.js.
			  //this.play();
			  
			  //进入播放页面,解锁重力感应
			  plus.screen.unlockOrientation();
		
			  // How about an event listener?
			   this.on('play', function () {
				   console.log('开始/恢复播放');
			   });
			   this.on('pause', function () {
				   console.log('暂停播放');
			   });
			   this.on('ended', function () {
				   console.log('结束播放');
			   });
			   //解锁加锁方法在华为手机上结果相反,现采用进入播放器解锁屏幕重力感应,退出播放器时竖屏正方向锁定
			  //  this.on('fullscreenchange', function () {
				 //   console.log('全屏变化');
				 //   var isFullScreen = this.isFullscreen();
				 //   console.log('是否是全屏:' + isFullScreen);
					// if (isFullScreen) {
					// 	console.log('是全屏，解除屏幕锁定');
					// 	plus.screen.unlockOrientation();
					// }else{
					// 	console.log('不是全屏，执行屏幕锁定');
					// 	plus.screen.lockOrientation("portrait-primary"); 
					// }
			  //  });
			});
			
			plus.key.addEventListener("backbutton", function(){
				plus.screen.lockOrientation("portrait-primary");
			});
			document.getElementById("muiBackButton").addEventListener("tap", function(){
				plus.screen.lockOrientation("portrait-primary");				
			});
			
			function updateVideoHits(hits){
				var info = [];
				var data = {
						op: "replace",
						path: "/vod_hits",
						value: hits
					};
				info.push(data);
				mui.ajax(APP_DOMAIN + "/videos/" + videoId,{
					data:JSON.stringify(info),
					datatype:'json',//服务器返回json格式数据
					type:'patch',//HTTP请求类型
					timeout:10000,//超时时间设置为10秒；
					headers:{'Content-Type':'application/json'},
					success:function(data){
						//console.log(JSON.stringify(data));
					},
					error:function(xhr,type,errorThrown){
						
					}
				});				
			};
		});
	</script>
</html>
